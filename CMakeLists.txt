cmake_minimum_required(VERSION 3.4)
MESSAGE(STATUS "DICe dev-pack for mac")

PROJECT(DICe::DevPack::Mac)

# rather than extract and store the file in this repo use the zip file from the releases page
# if(EXISTS "${CMAKE_CURRENT_BINARY_DIR}/trilinos-12.5")
#   MESSAGE(STATUS "Found Trilinos in ${CMAKE_BINARY_DIR}/trilinos-12.5")
# else()
#   MESSAGE(STATUS "Extracting Trilinos")
#   file(ARCHIVE_EXTRACT INPUT "${CMAKE_CURRENT_SOURCE_DIR}/trilinos/trilinos-12.5.zip" DESTINATION "${CMAKE_CURRENT_BINARY_DIR}")
# endif()

MESSAGE(STATUS "Using LAPACK from: ${LAPACK}")
MESSAGE(STATUS "Using BLAS from: ${BLAS}")
MESSAGE(STATUS "Using C compiler: ${CMAKE_C_COMPILER}")
MESSAGE(STATUS "Using C++ compiler: ${CMAKE_CXX_COMPILER}")
MESSAGE(STATUS "Using Fortran compiler: ${CMAKE_Fortran_COMPILER}")

SET(CMAKE_INSTALL_PREFIX ${CMAKE_CURRENT_BINARY_DIR}/trilinos/build/install)

SET(TRILINOS_CMAKE_ARGS -D CMAKE_CXX_COMPILER:FILEPATH=${CMAKE_CXX_COMPILER} -D CMAKE_C_COMPILER:FILEPATH=${CMAKE_C_COMPILER} -D CMAKE_Fortran_COMPILER:FILEPATH=${CMAKE_Fortran_COMPILER} -D CMAKE_INSTALL_PREFIX:PATH=${CMAKE_INSTALL_PREFIX} -D CMAKE_BUILD_TYPE:STRING=RELEASE -D CMAKE_CXX_FLAGS:STRING=-g -Wall -D CMAKE_C_FLAGS:STRING=-g -Wall -D Trilinos_ENABLE_Triutils=OFF -D Trilinos_ENABLE_DEBUG:BOOL=OFF -D Trilinos_ENABLE_CHECKED_STL:BOOL=OFF -D Trilinos_ENABLE_EXPLICIT_INSTANTIATION:BOOL=ON -D Trilinos_WARNINGS_AS_ERRORS_FLAGS:STRING= -D Trilinos_ENABLE_ALL_PACKAGES:BOOL=OFF -D Trilinos_ENABLE_ALL_OPTIONAL_PACKAGES:BOOL=OFF -D BUILD_SHARED_LIBS:BOOL=OFF -D TPL_FIND_SHARED_LIBS=OFF -D Trilinos_LINK_SEARCH_START_STATIC=ON -D CMAKE_VERBOSE_MAKEFILE:BOOL=OFF -D Trilinos_ENABLE_CXX11:BOOL=ON -D TPL_ENABLE_MPI:BOOL=OFF -D Trilinos_ENABLE_OpenMP:BOOL=OFF -D Trilinos_ENABLE_ThreadPool:BOOL=OFF -D Trilinos_ENABLE_Ifpack:BOOL=ON -D Trilinos_ENABLE_Ifpack2:BOOL=OFF -D TPL_ENABLE_CUDA:BOOL=OFF -D TPL_ENABLE_BinUtils=OFF -D TPL_ENABLE_BLAS:STRING=ON -D TPL_ENABLE_LAPACK:STRING=ON -D TPL_ENABLE_MKL:STRING=OFF -D TPL_ENABLE_HWLOC:STRING=OFF -D TPL_ENABLE_BLAS:BOOL=ON -D TPL_BLAS_LIBRARIES:FILEPATH=${BLAS} -D TPL_ENABLE_LAPACK:BOOL=ON -D TPL_LAPACK_LIBRARIES:FILEPATH=${LAPACK} -D Trilinos_ENABLE_SEACASExodus:BOOL=ON -D Trilinos_ENABLE_SEACASIoss:BOOL=OFF -D TPL_ENABLE_Netcdf:BOOL=ON -D Trilinos_ENABLE_Teuchos:BOOL=ON -D Trilinos_ENABLE_Belos:BOOL=ON -D Trilinos_ENABLE_KokkosContainers:BOOL=ON -D Trilinos_ENABLE_Tpetra:BOOL=OFF -D Trilinos_ENABLE_Epetra:BOOL=ON  -D Netcdf_INCLUDE_DIRS:PATH=${CMAKE_CURRENT_SOURCE_DIR}/netcdf/include -D Netcdf_LIBRARY_DIRS:PATH=${CMAKE_CURRENT_SOURCE_DIR}/netcdf/lib)

include(ExternalProject)

ExternalProject_Add(trilinos
  GIT_REPOSITORY git@github.com:trilinos/Trilinos.git
  GIT_TAG d81f520
  PREFIX ${CMAKE_CURRENT_BINARY_DIR}/trilinos
  BUILD_COMMAND ${CMAKE_COMMAND} --build ${CMAKE_BINARY_DIR}/trilinos/src/trilinos-build
  INSTALL_COMMAND ""
  CMAKE_ARGS ${TRILINOS_CMAKE_ARGS}
)

#ExternalProject_Add(trilinos
#  URL https://github.com/dicengine/dice/releases/download/v3.0-beta.4/trilinos-12.5.zip
#  PREFIX ${CMAKE_CURRENT_BINARY_DIR}/trilinos
#  BUILD_COMMAND ${CMAKE_COMMAND} --build ${CMAKE_BINARY_DIR}/trilinos/src/trilinos-build
#  CMAKE_ARGS ${TRILINOS_CMAKE_ARGS}
#)
#  TMP_DIR ${CMAKE_CURRENT_BINARY_DIR}/tilinos_tmp
#  INSTALL_DIR ${CMAKE_CURRENT_BINARY_DIR}/trilinos-12.5/build/install
#  INSTALL_COMMAND --install
